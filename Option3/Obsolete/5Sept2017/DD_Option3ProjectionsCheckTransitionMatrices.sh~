#!/bin/bash

# USAGE DD_Option3ProjectionsCheckTransitionMatrices.sh Results/DelayDifferenceModelParameters.csv Data/WeeklyPercentageOfSpawners.txt Results/LinearizedRickerCoef Data/AverageEffortPattern.txt Data/Availability.txt

# PURPOSE run projections multiple times

#  CREATED  19 November 2013
#  MODIFIED  8 August 2017

# Get only the parameter estimates from the result file
#cut -f2 -d"," $2 > /tmp/ParEstimates.txt

#LowerEffortValues=(0 1 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 24000 28000 32000 36000 40000)
#UpperEffortValue=(0 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 24000 28000 32000 36000 40000 50000)

#EffortValues=( 0 500 1500 2500 3500 4500 5500 6500 7500 8500 9500 10500 11500 12500 13500 14500 15500 16500 17500 18500 19500 22000 26000 30000 34000 38000 45000 )


LowerEffortValues=(0 1 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 21000 22000 23000 24000 25000 26000 27000 28000 29000 30000 31000 32000 33000 34000 35000 36000 37000 38000 39000 40000 41000 42000 43000 44000 45000 46000 47000 48000 49000)
UpperEffortValue=(0 1000 2000 3000 4000 5000 6000 7000 8000 9000 10000 11000 12000 13000 14000 15000 16000 17000 18000 19000 20000 21000 22000 23000 24000 25000 26000 27000 28000 29000 30000 31000 32000 33000 34000 35000 36000 37000 38000 39000 40000 41000 42000 43000 44000 45000 46000 47000 48000 49000 50000)

EffortValues=( 0 500 1500 2500 3500 4500 5500 6500 7500 8500 9500 10500 11500 12500 13500 14500 15500 16500 17500 18500 19500 20500 21500 22500 23500 24500 25500 26500 27500 28500 29500 30500 31500 32500 33500 34500 35500 36500 37500 38500 39500 40500 41500 42500 43500 44500 45500 46500 47500 48500 49500)


for j in `seq 0 50`
	 do
	     for i in `seq 1 1000`; 
	     do echo $i;
		DD_Option3Projections_forMDPWithEffortLimits $1 $2 $3 $4 $5 50 ${LowerEffortValues[$j]} ${UpperEffortValue[$j]} ;
		mkdir -p Results/Simulation/Checks/${EffortValues[$j]};
		cp Results/Simulation/Projections_byYear.txt Results/Simulation/Checks/${EffortValues[$j]}/Projections_byYear$i.txt;
	     done
done

# Extract recruitment in the last year
for j in `seq 0 50`
	 do
	 file="Results/Simulation/Checks/${EffortValues[$j]}/FinalRec.txt"
	 if [ -f $file ]; then
	     rm $file
	 fi

	 touch $file

	 ls Results/Simulation/Checks/${EffortValues[$j]}/Projections_byYear* | while read filename; do
	     tail -1 $filename | cut -d',' -f5 >> $file
	 done
done
